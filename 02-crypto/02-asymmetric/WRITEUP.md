Разбор [задачек по криптографии](https://github.com/xairy/mipt-ctf/tree/master/02-crypto/02-asymmetric).

## rsa

В этой задачке нужно расшифровать сообщение, зашифрованное с помощью RSA.
Делается это просто, в соответствии с [формулой](https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Decryption).

Поскольку числа большие, то возводить в степень, а потом уже брать модуль будет затратно.
Однако в Питоне есть функция `pow()` которая умеет быстро возводить в степень по модулю.

``` python
>>> c = 0x58ae101736022f486216e290d39e839e7d02a124f725865ed1b5eea7144a4c40828bd4d14dcea967561477a516ce338f293ca86efc72a272c332c5468ef43ed5d8062152aae9484a50051d71943cf4c3249d8c4b2f6c39680cc75e58125359edd2544e89f54d2e5cbed06bb3ed61e5ca7643ebb7fa04638aa0a0f23955e5b5d9
>>> d = 0x496747c7dceae300e22d5c3fa7fd1242bda36af8bc280f7f5e630271a92cbcbeb7ae04132a00d5fc379274cbce8c353faa891b40d087d7a4559e829e513c97467345adca3aa66550a68889cf930ecdfde706445b3f110c0cb4a81ca66f8630ed003feea59a51dc1d18a7f6301f2817cb53b1fb58b2a5ad163e9f1f9fe463b901
>>> n = 0xb197d3afe713816582ee988b276f635800f728f118f5125de1c7c1e57f2738351de8ac643c118a5480f867b6d8756021911818e470952bd0a5262ed86b4fc4c2b7962cd197a8bd8d8ae3f821ad712a42285db67c85983581c4c39f80dbb21bf700dbd2ae9709f7e307769b5c0e624b661441c1ddb62ef1fe7684bbe61d8a19e7
>>> hex(pow(c, d, n))
  '0x436f6e67726174756c6174696f6e73206f6e2064656372797074696e6720616e20525341206d6573736167652120596f757220666c6167206973206d6f64756c61725f61726974686d65746963735f6e6f745f736f5f6261645f61667465725f616c6cL'
>>> hex(pow(c, d, n))[2:-1]
'436f6e67726174756c6174696f6e73206f6e2064656372797074696e6720616e20525341206d6573736167652120596f757220666c6167206973206d6f64756c61725f61726974686d65746963735f6e6f745f736f5f6261645f61667465725f616c6c'
>>> hex(pow(c, d, n))[2:-1].decode('hex')
'Congratulations on decrypting an RSA message! Your flag is modular_arithmetics_not_so_bad_after_all'
```

## hexy

В этой задачке тоже нужно расшифровать сообщение, однако нам неизвестно число `d`.
Поскольку `d * e === 1 mod phi(n)`, то число `d` можно найти как обратное к `e` по модулю `phi(n)`, при условии, что мы знаем `phi(n)`.

Для нахождения `phi(n)` число `n` надо разложить на простые множители.
В этой задаче число `n` очень маленькое, поэтому разлодить его легко.
Например можно воспользоваться [этим сервисом](http://www.numberempire.com/numberfactorizer.php).
Получаем, что `p = 1239139183819289` и `q = 3791839183819279` и находим `phi(n) = (p - 1) * (q - 1)`.

Осталось найти `d` воспользовавшись [расширенным алгоритмом Евклида](https://stackoverflow.com/questions/4798654/modular-multiplicative-inverse-function-in-python).

## fermat

Эта задачка аналогична предыдущей, однако число `n` здесь значительно больше и факторизовать его в лоб не выйдет.
Здесь нужно было догадаться воспользоваться [методом факторизации Ферма](https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8_%D0%A4%D0%B5%D1%80%D0%BC%D0%B0).

## prime

В этой задачке Алиса и Боб попытались воспользоваться протоколом Диффи-Хеллмана, однако забыли использовать модуль и проводили все вычисления без него. В результате, вычислить их секретные экспоненты можно обычным логирифмированием.

``` python
>>> g = 5
>>> ga = 3552713678800500929355621337890625
>>> gb = 100974195868289511092701256356196637398170423693954944610595703125
>>> import math
>>> math.log(ga, g)
48.00000000000001
>>> math.log(gb, g)
93.0
```

Осталось вычислить ключ и расшифровать сообщение по [ссылке](http://www.tools4noobs.com/online_tools/decrypt/).

``` python
>>> key = (g ** 93) ** 48
```

## short

Эта задачка похожа на предыдущую, но теперь простой модуль используется.
Здесь надо было попробовать поперебирать значения `a` и `b`, продполагая что они не очень большие.
В действительности:

``` python
>>> g = 5
>>> p = 19208302915743920857294037403209473409509
>>> for a in xrange(1000 * 1000):
...   if pow(g, a, p) == 10986351755751103712777758371696540996168:
...     print a
... 
320912
```

Далее вычисляем ключ и расшифровываем сообщение.

## broken\*\*

Смотреть [здесь](https://github.com/BatmansKitchen/ctf-writeups/tree/master/2013-picoctf/Broken_RSA).

## mistakes\*\*

Смотреть [здесь](http://ehsandev.com/pico2014/cryptography/RSAMistake.html).
